<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Command Deck Calendar</title>
<style>
:root {
  --bg: #2a1b2e;
  --section-bg: #3b2640;
  --card-bg: #4b2b50;
  --text: #f3e5f5;
  --muted: #dcdcdc;
  --accent: #8e24aa;
  --hover: #7b1fa2;
  --work: #4dabf7;
  --personal: #f06292;
  --family: #ffca28;
}
body {
  font-family: 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 0;
}
header {
  text-align: center;
  background: var(--section-bg);
  padding: 20px;
}
header h1 { margin: 0; color: var(--text); }

main { max-width: 1000px; margin: 30px auto; padding: 0 20px; }

.controls {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 20px;
}
button {
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 6px;
  padding: 8px 12px;
  cursor: pointer;
}
button:hover { background: var(--hover); }

.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  background: var(--section-bg);
  border-radius: 10px;
  padding: 8px;
}
.day {
  background: var(--card-bg);
  min-height: 120px;
  border-radius: 8px;
  padding: 6px;
  position: relative;
  overflow: hidden;
}
.day:hover { background: var(--hover); cursor: pointer; }
.day-number { font-weight: bold; margin-bottom: 4px; }
.event {
  font-size: 0.8em;
  border-radius: 4px;
  margin-bottom: 3px;
  padding: 2px 4px;
  cursor: pointer;
}
.event.work { background: var(--work); color: #000; }
.event.personal { background: var(--personal); color: #000; }
.event.family { background: var(--family); color: #000; }

.modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: var(--card-bg);
  padding: 20px;
  border-radius: 10px;
  width: 300px;
}
.modal-content input, select {
  width: 100%;
  padding: 6px;
  margin-bottom: 10px;
  border: none;
  border-radius: 6px;
  background: var(--section-bg);
  color: var(--text);
}
.holiday { border: 2px solid var(--accent); }
.holiday-label { font-size: 0.75em; color: var(--muted); }
.csv-buttons { margin: 15px 0; display: flex; gap: 10px; }
.back { margin-bottom: 10px; display: inline-block; color: var(--text); text-decoration:none; }
.back:hover { text-decoration: underline; }
</style>
</head>
<body>
<header>
  <h1>Command Deck Calendar</h1>
</header>
<main>
  <a class="back" href="index.html">&larr; Back to Home</a>
  <div class="controls">
    <button id="prev-month">&lt;</button>
    <h2 id="month-year"></h2>
    <button id="next-month">&gt;</button>
  </div>

  <div class="csv-buttons">
    <button onclick="exportCSV()">Export CSV</button>
    <input type="file" id="importFile" accept=".csv" onchange="importCSV(event)">
    <button onclick="document.getElementById('importFile').click()">Import CSV</button>
  </div>

  <div class="calendar" id="calendar"></div>
</main>

<div class="modal" id="event-modal">
  <div class="modal-content">
    <h3 id="modal-title">Add Event</h3>
    <input type="text" id="event-name" placeholder="Event name" autofocus>
    <select id="event-category">
      <option value="work">Work</option>
      <option value="personal">Personal</option>
      <option value="family">Family</option>
    </select>
    <label><input type="checkbox" id="all-day"> All Day</label>
    <input type="time" id="start-time">
    <label><input type="checkbox" id="rec-monthly"> Repeat Monthly</label>
    <label><input type="checkbox" id="rec-annual"> Repeat Annually</label>
    <div style="display:flex;justify-content:space-between;">
      <button id="save-event">Save</button>
      <button id="delete-event" style="background:#e74c3c;display:none;">Delete</button>
      <button onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<script>
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();
let selectedDate = null;
let editingIndex = null;
let events = [];

const holidays = {
  "New Year's Day": [0,1],
  "MLK Day": [0,"third-monday"],
  "Memorial Day": [4,"last-monday"],
  "Independence Day": [6,4],
  "Labor Day": [8,"first-monday"],
  "Halloween": [9,31],
  "Thanksgiving": [10,"fourth-thursday"],
  "Black Friday": [10,"fourth-friday"],
  "Christmas Eve": [11,24],
  "Christmas Day": [11,25]
};

function isHoliday(date){
  const d = new Date(date);
  const month = d.getMonth(), day = d.getDate(), dow = d.getDay();
  for (let [name, val] of Object.entries(holidays)){
    if (Array.isArray(val) && typeof val[1]==="number" && val[0]===month && val[1]===day) return name;
    if (typeof val[1]==="string" && val[0]===month){
      const firstDay = new Date(d.getFullYear(), month, 1);
      let match;
      if (val[1].startsWith("first-")) match = firstXDay(month,d.getFullYear(),dayOfWeek(val[1].split("-")[1]));
      if (val[1].startsWith("third-")) match = firstXDay(month,d.getFullYear(),dayOfWeek(val[1].split("-")[1]))+14;
      if (val[1]==="last-monday") match = lastXDay(month,d.getFullYear(),1);
      if (val[1]==="fourth-thursday") match = firstXDay(month,d.getFullYear(),4)+21;
      if (val[1]==="fourth-friday") match = firstXDay(month,d.getFullYear(),5)+21;
      if(day===match) return name;
    }
  }
  return null;
}
function dayOfWeek(str){ return ["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].indexOf(str);}
function firstXDay(month, year, dow){ const first=new Date(year,month,1); return 1+(dow-first.getDay()+7)%7; }
function lastXDay(month, year, dow){ const last=new Date(year,month+1,0); return last.getDate()-(last.getDay()-dow+7)%7; }

function renderCalendar(){
  const cal=document.getElementById('calendar');
  cal.innerHTML='';
  const monthYear=document.getElementById('month-year');
  const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];
  monthYear.textContent=`${monthNames[currentMonth]} ${currentYear}`;
  const firstDay=new Date(currentYear,currentMonth,1).getDay();
  const daysInMonth=new Date(currentYear,currentMonth+1,0).getDate();

  for(let i=0;i<firstDay;i++){ cal.appendChild(document.createElement('div')).className='day'; }

  for(let d=1;d<=daysInMonth;d++){
    const dayEl=document.createElement('div'); dayEl.className='day';
    const dateStr=`${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const holiday=isHoliday(dateStr); if(holiday) dayEl.classList.add('holiday');
    dayEl.innerHTML=`<div class='day-number'>${d}${holiday?`<div class='holiday-label'>${holiday}</div>`:''}</div>`;
    const todaysEvents=events.filter(ev=>ev.date===dateStr);
    const allDay=todaysEvents.filter(e=>e.allDay);
    const timed=todaysEvents.filter(e=>!e.allDay);
    [...allDay,...timed].forEach(ev=>{
      const e=document.createElement('div');
      e.className=`event ${ev.category}`;
      const timeText=ev.allDay?'All Day':ev.time;
      e.textContent=`${timeText} - ${ev.name}`;
      e.onclick=(evt)=>{ evt.stopPropagation(); editEvent(ev,dateStr); };
      dayEl.appendChild(e);
    });
    dayEl.onclick=()=>openModal(dateStr);
    cal.appendChild(dayEl);
  }
}

function openModal(dateStr){
  selectedDate=dateStr; editingIndex=null;
  document.getElementById('event-name').value='';
  document.getElementById('event-category').value='work';
  document.getElementById('all-day').checked=false;
  document.getElementById('start-time').value='';
  document.getElementById('rec-monthly').checked=false;
  document.getElementById('rec-annual').checked=false;
  document.getElementById('delete-event').style.display='none';
  document.getElementById('event-modal').style.display='flex';
  document.getElementById('event-name').focus();
}
function closeModal(){ document.getElementById('event-modal').style.display='none'; }

document.getElementById('save-event').onclick=()=>{
  const name=document.getElementById('event-name').value.trim();
  if(!name) return;
  const cat=document.getElementById('event-category').value;
  const time=document.getElementById('start-time').value;
  const allDay=document.getElementById('all-day').checked;
  const recM=document.getElementById('rec-monthly').checked;
  const recA=document.getElementById('rec-annual').checked;
  const ev={name,category:cat,date:selectedDate,time:formatTime(time),allDay,recMonthly:recM,recAnnual:recA};
  if(editingIndex!==null) events[editingIndex]=ev; else events.push(ev);
  closeModal(); renderCalendar();
};
function editEvent(ev,dateStr){
  selectedDate=dateStr;
  editingIndex=events.findIndex(e=>e===ev);
  document.getElementById('event-name').value=ev.name;
  document.getElementById('event-category').value=ev.category;
  document.getElementById('all-day').checked=ev.allDay;
  document.getElementById('start-time').value=ev.time?to24Hour(ev.time):'';
  document.getElementById('rec-monthly').checked=ev.recMonthly;
  document.getElementById('rec-annual').checked=ev.recAnnual;
  document.getElementById('delete-event').style.display='inline-block';
  document.getElementById('event-modal').style.display='flex';
}
document.getElementById('delete-event').onclick=()=>{
  if(editingIndex!==null){ events.splice(editingIndex,1); }
  closeModal(); renderCalendar();
};

function formatTime(t){ if(!t)return ''; const [h,m]=t.split(':').map(Number); const ampm=h>=12?'PM':'AM'; const hr=h%12||12; return `${hr}:${String(m).padStart(2,'0')} ${ampm}`; }
function to24Hour(str){ if(!str) return ''; const [time,ampm]=str.split(' '); let [h,m]=time.split(':').map(Number); if(ampm==='PM'&&h!==12)h+=12; if(ampm==='AM'&&h===12)h=0; return `${String(h).padStart(2,'0')}:${m}`; }

document.getElementById('prev-month').onclick=()=>{ currentMonth--; if(currentMonth<0){currentMonth=11;currentYear--;} renderCalendar(); };
document.getElementById('next-month').onclick=()=>{ currentMonth++; if(currentMonth>11){currentMonth=0;currentYear++;} renderCalendar(); };

function exportCSV(){
  let csv='Name,Category,Date,Time,AllDay,RecurringMonthly,RecurringAnnual\n';
  events.forEach(ev=>{ csv+=`${ev.name},${ev.category},${ev.date},${ev.time},${ev.allDay},${ev.recMonthly},${ev.recAnnual}\n`; });
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='calendar_events.csv'; a.click();
}

function importCSV(e){
  const file=e.target.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=function(evt){
    const lines=evt.target.result.trim().split('\n').slice(1);
    lines.forEach(line=>{
      const [name,category,date,time,allDay,recM,recA]=line.split(',');
      events.push({name,category,date,time,allDay:allDay==='true',recMonthly:recM==='true',recAnnual:recA==='true'});
    });
    renderCalendar();
  };
  reader.readAsText(file);
}

renderCalendar();
</script>
</body>
</html>
