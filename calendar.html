<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calendar Hub</title>
<style>
:root {
  --bg: #2a1b2e;
  --section-bg: #3b2640;
  --card-bg: #4b2b50;
  --text: #f3e5f5;
  --muted: #dcdcdc;
  --accent: #8e24aa;
  --hover: #7b1fa2;
  --work: #ff5722;
  --personal: #03a9f4;
  --family: #ffeb3b;
  --holiday: #4caf50;
}
body {
  margin:0;
  font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: var(--bg);
  color: var(--text);
}
header {
  background: var(--section-bg);
  padding: 20px;
  text-align:center;
}
header h1 {
  margin:0;
}
main {
  max-width: 1100px;
  margin: 30px auto 80px;
  padding:0 15px;
}
button, input, select {
  font-family:'Segoe UI';
  border-radius:5px;
  border:none;
  padding:5px 10px;
  margin:3px;
}
button:hover { background: var(--hover); cursor:pointer; }
#calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:5px; }
.day {
  background: var(--card-bg);
  border-radius:8px;
  min-height:90px;
  position:relative;
  padding:5px;
  box-shadow:0 3px 10px rgba(0,0,0,0.3);
}
.day-header { font-weight:bold; margin-bottom:3px; }
.events { font-size:0.8em; max-height:60px; overflow-y:auto; }
.event { margin:1px 0; padding:2px 4px; border-radius:4px; color:#000; cursor:pointer; }
.event.work { background: var(--work); }
.event.personal { background: var(--personal); }
.event.family { background: var(--family); }
.event.holiday { background: var(--holiday); color:#fff; font-weight:bold; }
.modal-bg { display:none; position:fixed; top:0; left:0;width:100%;height:100%;background:rgba(0,0,0,0.7); justify-content:center; align-items:center; }
.modal { background:var(--section-bg); padding:20px; border-radius:10px; min-width:300px; color:var(--text); }
.modal input, .modal select { width:100%; margin:5px 0; }
.modal button { width:49%; }
.nav { margin-bottom:20px; }
.nav a { color:var(--accent); text-decoration:none; margin-right:10px; }
.nav a:hover { text-decoration:underline; }
</style>
</head>
<body>
<header>
  <h1>Calendar Hub</h1>
</header>
<main>
<div class="nav"><a href="index.html">&larr; Home</a></div>
<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
  <button onclick="prevMonth()">&#8592; Prev</button>
  <h2 id="month-year"></h2>
  <button onclick="nextMonth()">Next &#8594;</button>
</div>
<div id="calendar"></div>

<!-- Event Modal -->
<div class="modal-bg" id="modal-bg">
  <div class="modal">
    <h3 id="modal-title">Add Event</h3>
    <label>Event Name:</label>
    <input type="text" id="event-name" autofocus>
    <label>Category:</label>
    <select id="event-cat">
      <option value="work">Work</option>
      <option value="personal">Personal</option>
      <option value="family">Family</option>
    </select>
    <label>Time:</label>
    <input type="time" id="event-time">
    <label><input type="checkbox" id="event-allday"> All Day</label>
    <label>Recurring:</label>
    <select id="event-rec">
      <option value="none">None</option>
      <option value="monthly">Monthly</option>
      <option value="annual">Annual</option>
    </select>
    <div style="margin-top:10px; text-align:right;">
      <button onclick="saveEvent()">Save</button>
      <button onclick="closeModal()">Cancel</button>
      <button id="delete-event-btn" onclick="deleteEvent()" style="background:red; color:#fff; display:none;">Delete</button>
    </div>
  </div>
</div>

<div style="margin-top:20px;">
  <button onclick="exportCSV()">Export CSV</button>
  <input type="file" id="import-file" onchange="importCSV(event)">
</div>
</main>

<script>
let today=new Date();
let currentMonth=today.getMonth();
let currentYear=today.getFullYear();
let events=[];
let editIndex=null;

const monthNames=['January','February','March','April','May','June','July','August','September','October','November','December'];
const weekDays=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

function renderCalendar(){
  const calendar=document.getElementById('calendar');
  calendar.innerHTML='';
  document.getElementById('month-year').innerText=`${monthNames[currentMonth]} ${currentYear}`;
  const firstDay=new Date(currentYear,currentMonth,1).getDay();
  const daysInMonth=new Date(currentYear,currentMonth+1,0).getDate();
  // Blank spaces for first week
  for(let i=0;i<firstDay;i++){
    const empty=document.createElement('div');
    calendar.appendChild(empty);
  }
  for(let d=1;d<=daysInMonth;d++){
    const dayDiv=document.createElement('div');
    dayDiv.classList.add('day');
    dayDiv.dataset.date=`${currentYear}-${currentMonth+1}-${d}`;
    dayDiv.onclick=()=>openModal(d);
    const header=document.createElement('div');
    header.classList.add('day-header');
    header.innerText=d;
    dayDiv.appendChild(header);
    const evContainer=document.createElement('div');
    evContainer.classList.add('events');
    // render events
    const dayEvents=getEventsForDay(currentYear,currentMonth+1,d);
    dayEvents.forEach((ev,i)=>{
      const evDiv=document.createElement('div');
      evDiv.classList.add('event',ev.category);
      evDiv.innerText=ev.name+(ev.allday?' (All Day)':'')+(ev.holiday?' '+ev.holidayLabel:'');
      evDiv.onclick=(e)=>{
        e.stopPropagation();
        editEvent(ev,i);
      };
      evContainer.appendChild(evDiv);
    });
    dayDiv.appendChild(evContainer);
    calendar.appendChild(dayDiv);
  }
}

// ------- Event Logic -------
function openModal(day){
  editIndex=null;
  document.getElementById('modal-title').innerText='Add Event';
  document.getElementById('event-name').value='';
  document.getElementById('event-cat').value='work';
  document.getElementById('event-time').value='';
  document.getElementById('event-allday').checked=false;
  document.getElementById('event-rec').value='none';
  document.getElementById('delete-event-btn').style.display='none';
  document.getElementById('modal-bg').style.display='flex';
  document.getElementById('modal-bg').dataset.day=day;
  document.getElementById('event-name').focus();
}

function closeModal(){document.getElementById('modal-bg').style.display='none';}

function saveEvent(){
  const name=document.getElementById('event-name').value.trim();
  if(!name){ alert('Enter name'); return; }
  const category=document.getElementById('event-cat').value;
  const time=document.getElementById('event-time').value;
  const allday=document.getElementById('event-allday').checked;
  const rec=document.getElementById('event-rec').value;
  const day=parseInt(document.getElementById('modal-bg').dataset.day);
  const ev={name,category,time,allday,rec,year:currentYear,month:currentMonth+1,day};
  if(editIndex!==null){
    events[editIndex]=ev;
  } else {
    events.push(ev);
  }
  closeModal();
  renderCalendar();
}

function editEvent(ev,index){
  editIndex=index;
  document.getElementById('modal-title').innerText='Edit Event';
  document.getElementById('event-name').value=ev.name;
  document.getElementById('event-cat').value=ev.category;
  document.getElementById('event-time').value=ev.time;
  document.getElementById('event-allday').checked=ev.allday;
  document.getElementById('event-rec').value=ev.rec;
  document.getElementById('delete-event-btn').style.display='inline-block';
  document.getElementById('modal-bg').style.display='flex';
  document.getElementById('modal-bg').dataset.day=ev.day;
}

function deleteEvent(){
  if(editIndex!==null){
    events.splice(editIndex,1);
    closeModal();
    renderCalendar();
  }
}

// ------- Recurring & Event Fetch -------
function getEventsForDay(y,m,d){
  const dayEvents=[];
  events.forEach(ev=>{
    if(ev.holiday) { return; } // holidays handled separately
    if(ev.rec==='none'){
      if(ev.year===y && ev.month===m && ev.day===d) dayEvents.push(ev);
    } else if(ev.rec==='monthly'){
      if(ev.day===d) dayEvents.push(ev);
    } else if(ev.rec==='annual'){
      if(ev.month===m && ev.day===d) dayEvents.push(ev);
    }
  });
  return dayEvents.sort((a,b)=>a.allday? -1 : 1);
}

// ------- Navigation -------
function prevMonth(){ currentMonth--; if(currentMonth<0){ currentMonth=11; currentYear--; } renderCalendar(); }
function nextMonth(){ currentMonth++; if(currentMonth>11){ currentMonth=0; currentYear++; } renderCalendar(); }

// ------- CSV Export/Import -------
function exportCSV(){
  let csv='name,category,time,allday,rec,year,month,day\n';
  events.forEach(ev=>{
    csv+=`${ev.name},${ev.category},${ev.time},${ev.allday},${ev.rec},${ev.year},${ev.month},${ev.day}\n`;
  });
  const blob=new Blob([csv],{type:'text/csv'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url; a.download='calendar_events.csv'; a.click();
  URL.revokeObjectURL(url);
}

function importCSV(e){
  const file=e.target.files[0];
  const reader=new FileReader();
  reader.onload=function(ev){
    const text=ev.target.result;
    const lines=text.split('\n').slice(1); // skip header
    lines.forEach(l=>{
      if(!l.trim()) return;
      const [name,category,time,allday,rec,year,month,day]=l.split(',');
      events.push({name,category,time,allday:allday==='true',rec,year:parseInt(year),month:parseInt(month),day:parseInt(day)});
    });
    renderCalendar();
  };
  reader.readAsText(file);
  e.target.value='';
}

// ------- Holidays -------
function addHolidays(){
  const hEv=(name,month,day)=>events.push({name,category:'holiday',allday:true,holiday:true,holidayLabel:name,year:currentYear,month,day});
  // fixed
  hEv("New Year's Day",1,1);
  hEv("Independence Day",7,4);
  hEv("Halloween",10,31);
  hEv("Christmas Eve",12,24);
  hEv("Christmas Day",12,25);
  // floating
  hEv("MLK Day",1,nthWeekday(3,1,1)); // 3rd Monday Jan
  hEv("Memorial Day",5,lastWeekday(1,5)); // last Monday May
  hEv("Labor Day",9,nthWeekday(1,1,9)); // 1st Monday Sept
  hEv("Thanksgiving",11,nthWeekday(4,4,11)); // 4th Thursday Nov
  hEv("Black Friday",11,nthWeekday(4,4,11)+1); // day after
}

// nthWeekday(n,weekday,month)
function nthWeekday(n,wd,m){
  const first=new Date(currentYear,m-1,1);
  let count=0;
  for(let d=1;d<=31;d++){
    const dt=new Date(currentYear,m-1,d);
    if(dt.getMonth()!==m-1) break;
    if(dt.getDay()===wd){ count++; if(count===n) return d; }
  }
  return 1;
}

// lastWeekday(weekday,month)
function lastWeekday(wd,m){
  const last=new Date(currentYear,m,0);
  for(let d=last.getDate();d>=1;d--){
    const dt=new Date(currentYear,m-1,d);
    if(dt.getDay()===wd) return d;
  }
  return 1;
}

// ------- Init -------
addHolidays();
renderCalendar();
</script>
</body>
</html>
