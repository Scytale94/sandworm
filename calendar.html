<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Calendar Hub</title>
<style>
  :root {
    --bg: #2a1b2e;
    --section-bg: #3b2640;
    --card-bg: #4b2b50;
    --text: #f3e5f5;
    --muted: #dcdcdc;
    --accent: #8e24aa;
    --hover: #7b1fa2;
  }

  body {
    font-family: 'Segoe UI', sans-serif;
    background-color: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 0;
  }

  header {
    text-align: center;
    padding: 1rem;
    background-color: var(--section-bg);
  }

  h1 {
    color: var(--accent);
  }

  #calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 6px;
    padding: 20px;
  }

  .day {
    background: var(--card-bg);
    border-radius: 8px;
    min-height: 100px;
    padding: 8px;
    cursor: pointer;
    position: relative;
    transition: background 0.2s;
  }

  .day:hover {
    background: var(--hover);
  }

  .day-number {
    font-weight: bold;
    font-size: 1.1em;
  }

  .event {
    border-radius: 4px;
    padding: 3px 4px;
    margin-top: 4px;
    font-size: 0.9em;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .event span:first-child {
    flex-grow: 1;
  }

  .event button {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 0.9em;
    margin-left: 5px;
  }

  .family { background: #8e24aa; }
  .personal { background: #2196f3; }
  .work { background: #4caf50; }

  #eventModal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--section-bg);
    padding: 20px;
    border-radius: 8px;
    z-index: 10;
    width: 280px;
  }

  #eventModal input,
  #eventModal select,
  #eventModal label {
    width: 100%;
    margin-bottom: 10px;
    display: block;
    background: none;
    color: var(--text);
  }

  #eventModal input[type="text"],
  #eventModal input[type="time"],
  #eventModal select {
    padding: 6px;
    background: var(--card-bg);
    border: none;
    border-radius: 4px;
  }

  #eventModal button {
    background: var(--accent);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    margin-right: 8px;
  }

  #eventModal button:hover {
    background: var(--hover);
  }

  #controls {
    text-align: center;
    margin: 10px;
  }

  #controls button {
    background: var(--accent);
    color: white;
    border: none;
    padding: 8px 12px;
    margin: 5px;
    border-radius: 6px;
    cursor: pointer;
  }

  #controls button:hover {
    background: var(--hover);
  }

</style>
</head>
<body>
  <header>
    <h1>Monthly Calendar</h1>
  </header>

  <div id="controls">
    <button onclick="prevMonth()">‚Üê Prev</button>
    <span id="monthYear"></span>
    <button onclick="nextMonth()">Next ‚Üí</button>
    <button onclick="exportToCSV()">Export to CSV</button>
    <input type="file" id="importCSV" accept=".csv" onchange="importFromCSV(event)" style="display:none;">
    <button onclick="document.getElementById('importCSV').click()">Import CSV</button>
  </div>

  <div id="calendar"></div>

  <div id="eventModal">
    <h3 id="modalTitle">Add Event</h3>
    <input type="text" id="eventName" placeholder="Event name..." autofocus>
    <label>Start time:</label>
    <input type="time" id="eventTime">
    <label><input type="checkbox" id="allDay"> All Day Event</label>
    <label>Category:</label>
    <select id="eventCategory">
      <option value="family">Family</option>
      <option value="personal">Personal</option>
      <option value="work">Work</option>
    </select>
    <button onclick="saveEvent()">Save</button>
    <button onclick="closeModal()">Cancel</button>
  </div>

<script>
  let currentMonth = new Date().getMonth();
  let currentYear = new Date().getFullYear();
  let events = JSON.parse(localStorage.getItem('calendarEvents')) || {};
  let selectedDate = null;
  let editingEvent = null;

  function renderCalendar() {
    const calendar = document.getElementById('calendar');
    calendar.innerHTML = '';

    const firstDay = new Date(currentYear, currentMonth, 1);
    const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
    const startDay = firstDay.getDay();

    document.getElementById('monthYear').innerText =
      firstDay.toLocaleString('default', { month: 'long' }) + ' ' + currentYear;

    for (let i = 0; i < startDay; i++) {
      const blank = document.createElement('div');
      calendar.appendChild(blank);
    }

    for (let day = 1; day <= daysInMonth; day++) {
      const cell = document.createElement('div');
      cell.classList.add('day');
      const key = `${currentYear}-${currentMonth + 1}-${day}`;
      cell.innerHTML = `<div class="day-number">${day}</div>`;

      if (events[key]) {
        // Sort all-day events first
        const dayEvents = [...events[key]].sort((a, b) => {
          if (a.allDay && !b.allDay) return -1;
          if (!a.allDay && b.allDay) return 1;
          return a.time.localeCompare(b.time);
        });

        dayEvents.forEach((event, index) => {
          const eventDiv = document.createElement('div');
          eventDiv.classList.add('event', event.category);
          const timeStr = event.allDay ? 'All Day' : convertTo12Hour(event.time);
          eventDiv.innerHTML = `
            <span>${timeStr} - ${event.name}</span>
            <span>
              <button onclick="editEvent('${key}', ${index})">‚úèÔ∏è</button>
              <button onclick="deleteEvent('${key}', ${index})">üóëÔ∏è</button>
            </span>`;
          cell.appendChild(eventDiv);
        });
      }

      cell.onclick = () => openModal(key);
      calendar.appendChild(cell);
    }
  }

  function convertTo12Hour(time) {
    if (!time) return '';
    const [h, m] = time.split(':');
    let hour = parseInt(h);
    const ampm = hour >= 12 ? 'PM' : 'AM';
    hour = hour % 12 || 12;
    return `${hour}:${m} ${ampm}`;
  }

  function openModal(dateKey) {
    selectedDate = dateKey;
    editingEvent = null;
    document.getElementById('modalTitle').innerText = "Add Event";
    document.getElementById('eventName').value = '';
    document.getElementById('eventTime').value = '';
    document.getElementById('allDay').checked = false;
    document.getElementById('eventCategory').value = 'personal';
    document.getElementById('eventModal').style.display = 'block';
    document.getElementById('eventName').focus();
  }

  function closeModal() {
    document.getElementById('eventModal').style.display = 'none';
  }

  function saveEvent() {
    const name = document.getElementById('eventName').value.trim();
    const time = document.getElementById('eventTime').value;
    const allDay = document.getElementById('allDay').checked;
    const category = document.getElementById('eventCategory').value;

    if (!name) return alert("Enter an event name.");

    if (!events[selectedDate]) events[selectedDate] = [];

    if (editingEvent !== null) {
      events[selectedDate][editingEvent] = { name, time, allDay, category };
    } else {
      events[selectedDate].push({ name, time, allDay, category });
    }

    localStorage.setItem('calendarEvents', JSON.stringify(events));
    closeModal();
    renderCalendar();
  }

  function editEvent(dateKey, index) {
    const event = events[dateKey][index];
    selectedDate = dateKey;
    editingEvent = index;
    document.getElementById('modalTitle').innerText = "Edit Event";
    document.getElementById('eventName').value = event.name;
    document.getElementById('eventTime').value = event.time;
    document.getElementById('allDay').checked = event.allDay;
    document.getElementById('eventCategory').value = event.category;
    document.getElementById('eventModal').style.display = 'block';
    document.getElementById('eventName').focus();
  }

  function deleteEvent(dateKey, index) {
    events[dateKey].splice(index, 1);
    if (events[dateKey].length === 0) delete events[dateKey];
    localStorage.setItem('calendarEvents', JSON.stringify(events));
    renderCalendar();
  }

  function prevMonth() {
    currentMonth--;
    if (currentMonth < 0) {
      currentMonth = 11;
      currentYear--;
    }
    renderCalendar();
  }

  function nextMonth() {
    currentMonth++;
    if (currentMonth > 11) {
      currentMonth = 0;
      currentYear++;
    }
    renderCalendar();
  }

  function exportToCSV() {
    let csv = "Date,Event,Time,AllDay,Category\n";
    for (const [date, evs] of Object.entries(events)) {
      evs.forEach(e => {
        csv += `${date},${e.name},${e.time},${e.allDay},${e.category}\n`;
      });
    }
    const blob = new Blob([csv], { type: 'text/csv' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = "calendar_events.csv";
    a.click();
  }

  function importFromCSV(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      const lines = e.target.result.split('\n').slice(1);
      lines.forEach(line => {
        if (!line.trim()) return;
        const [date, name, time, allDay, category] = line.split(',');
        events[date] = events[date] || [];
        events[date].push({ name, time, allDay: allDay === 'true', category });
      });
      localStorage.setItem('calendarEvents', JSON.stringify(events));
      renderCalendar();
    };
    reader.readAsText(file);
  }

  renderCalendar();
</script>
</body>
</html>
