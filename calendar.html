<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calendar Hub</title>
<style>
  :root {
    --bg: #2a1b2e;
    --section-bg: #3b2640;
    --card-bg: #4b2b50;
    --text: #f3e5f5;
    --muted: #dcdcdc;
    --accent: #8e24aa;
    --hover: #7b1fa2;
    --holiday-color: #ff9800;
    --work-color: #2196f3;
    --personal-color: #4caf50;
    --family-color: #f44336;
  }
  body { margin:0; font-family:'Segoe UI', sans-serif; background:var(--bg); color:var(--text);}
  header { text-align:center; padding:20px;}
  header h1 { margin:0; }
  main { max-width:1000px; margin:20px auto; padding:0 20px; }
  #calendar-controls { display:flex; justify-content:space-between; margin-bottom:10px; }
  #calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:5px; }
  .day { background:var(--section-bg); padding:5px; border-radius:6px; min-height:80px; position:relative; cursor:pointer; }
  .day-number { font-weight:bold; margin-bottom:3px; }
  .holiday { background:var(--holiday-color); color:#000; }
  .event { margin:2px 0; padding:2px 4px; border-radius:3px; color:#fff; font-size:0.8em; cursor:pointer; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;}
  .event.work { background:var(--work-color);}
  .event.personal { background:var(--personal-color);}
  .event.family { background:var(--family-color);}
  #event-modal { display:none; position:fixed; top:0; left:0;width:100%;height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center;}
  #event-modal .modal-content { background:var(--card-bg); padding:20px; border-radius:10px; min-width:300px; }
  input, select { padding:5px; margin:5px 0; width:100%; border-radius:4px; border:none; background:var(--section-bg); color:var(--text); }
  button { padding:6px 12px; border:none; border-radius:5px; background:var(--accent); color:#fff; cursor:pointer; margin:5px 0; }
  button:hover { background:var(--hover); }
  .back { display:inline-block; margin-bottom:10px; color:var(--text); text-decoration:none;}
  .holiday-label { font-size:0.7em; display:block; }
</style>
</head>
<body>
<header>
  <h1>Calendar Hub</h1>
  <a class="back" href="index.html">&larr; Back to Home</a>
</header>
<main>
  <div id="calendar-controls">
    <button id="prev-month">&larr; Previous</button>
    <span id="month-label"></span>
    <button id="next-month">Next &rarr;</button>
    <button onclick="exportCSV()">Export CSV</button>
    <button onclick="document.getElementById('import-file').click()">Import CSV</button>
    <input type="file" id="import-file" style="display:none" onchange="importCSV(event)">
  </div>
  <div id="calendar"></div>
</main>

<div id="event-modal">
  <div class="modal-content">
    <h3>Event</h3>
    <input type="text" id="event-name" placeholder="Event Name">
    <select id="event-category">
      <option value="work">Work</option>
      <option value="personal">Personal</option>
      <option value="family">Family</option>
    </select>
    <label><input type="checkbox" id="all-day"> All Day</label>
    <input type="time" id="start-time">
    <label><input type="checkbox" id="rec-monthly"> Recurring Monthly</label>
    <label><input type="checkbox" id="rec-annual"> Recurring Annually</label>
    <div>
      <button id="save-event">Save</button>
      <button id="delete-event" style="display:none">Delete</button>
      <button onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<script>
const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];
let currentDate=new Date(),currentMonth=currentDate.getMonth(),currentYear=currentDate.getFullYear();
let events=[],selectedDate=null,editingIndex=null;
const holidays=[
  {month:0,day:1,label:"New Year's Day"},
  {month:0,day:15,label:"MLK Day"}, // Note: adjust MLK to correct calculation if needed
  {month:6,day:4,label:"July 4th"},
  {month:10,day:28,label:"Thanksgiving"}, // simplified for demonstration
  {month:10,day:29,label:"Black Friday"},
  {month:11,day:24,label:"Christmas Eve"},
  {month:11,day:25,label:"Christmas Day"},
  {month:9,day:31,label:"Halloween"},
  {month:4,day:31,label:"Memorial Day"},
  {month:8,day:1,label:"Labor Day"}
];

function isHoliday(dateStr){
  const d=new Date(dateStr);
  for(const h of holidays){
    if(h.month===d.getMonth() && h.day===d.getDate()) return h.label;
  }
  return null;
}

function renderCalendar(){
  document.getElementById('month-label').innerText=`${monthNames[currentMonth]} ${currentYear}`;
  const cal=document.getElementById('calendar');
  cal.innerHTML='';
  const firstDay=new Date(currentYear,currentMonth,1).getDay();
  const daysInMonth=new Date(currentYear,currentMonth+1,0).getDate();
  // Add blank days for first day
  for(let i=0;i<firstDay;i++){ cal.appendChild(document.createElement('div')).className='day'; }
  for(let d=1;d<=daysInMonth;d++){
    const dayEl=document.createElement('div'); dayEl.className='day';
    const dateStr=`${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const holiday=isHoliday(dateStr); if(holiday) dayEl.classList.add('holiday');
    dayEl.innerHTML=`<div class='day-number'>${d}${holiday?`<div class='holiday-label'>${holiday}</div>`:''}</div>`;
    const todaysEvents=events.filter(ev=>ev.date===dateStr);
    const allDay=todaysEvents.filter(e=>e.allDay);
    const timed=todaysEvents.filter(e=>!e.allDay);
    [...allDay,...timed].forEach(ev=>{
      const e=document.createElement('div');
      e.className=`event ${ev.category}`;
      const timeText=ev.allDay?'All Day':ev.time;
      e.textContent=`${timeText} - ${ev.name}`;
      e.onclick=(evt)=>{ evt.stopPropagation(); editEvent(ev,dateStr); };
      dayEl.appendChild(e);
    });
    dayEl.onclick=()=>openModal(dateStr);
    cal.appendChild(dayEl);
  }
}

function openModal(dateStr){
  selectedDate=dateStr; editingIndex=null;
  document.getElementById('event-name').value='';
  document.getElementById('event-category').value='work';
  document.getElementById('all-day').checked=false;
  document.getElementById('start-time').value='';
  document.getElementById('rec-monthly').checked=false;
  document.getElementById('rec-annual').checked=false;
  document.getElementById('delete-event').style.display='none';
  document.getElementById('event-modal').style.display='flex';
  document.getElementById('event-name').focus();
}

function closeModal(){ document.getElementById('event-modal').style.display='none'; }

document.getElementById('save-event').onclick=()=>{
  const name=document.getElementById('event-name').value.trim();
  if(!name) return;
  const cat=document.getElementById('event-category').value;
  const time=document.getElementById('start-time').value;
  const allDay=document.getElementById('all-day').checked;
  const recM=document.getElementById('rec-monthly').checked;
  const recA=document.getElementById('rec-annual').checked;
  const ev={name,category:cat,date:selectedDate,time,allDay,recMonthly:recM,recAnnual:recA};
  if(editingIndex!==null){ events[editingIndex]=ev; }
  else{ events.push(ev); }
  closeModal(); renderCalendar();
}

function editEvent(ev,dateStr){
  selectedDate=dateStr;
  editingIndex=events.indexOf(ev);
  document.getElementById('event-name').value=ev.name;
  document.getElementById('event-category').value=ev.category;
  document.getElementById('all-day').checked=ev.allDay;
  document.getElementById('start-time').value=ev.time;
  document.getElementById('rec-monthly').checked=ev.recMonthly;
  document.getElementById('rec-annual').checked=ev.recAnnual;
  document.getElementById('delete-event').style.display='inline-block';
  document.getElementById('event-modal').style.display='flex';
}

document.getElementById('delete-event').onclick=()=>{
  if(editingIndex!==null){ events.splice(editingIndex,1); }
  closeModal(); renderCalendar();
}

document.getElementById('prev-month').onclick=()=>{
  currentMonth--; if(currentMonth<0){ currentMonth=11; currentYear--; } renderCalendar();
}
document.getElementById('next-month').onclick=()=>{
  currentMonth++; if(currentMonth>11){ currentMonth=0; currentYear++; } renderCalendar();
}

function exportCSV(){
  let csv='Date,Name,Category,Time,AllDay,Monthly,Annual\n';
  events.forEach(ev=>{
    csv+=`${ev.date},${ev.name},${ev.category},${ev.time},${ev.allDay},${ev.recMonthly},${ev.recAnnual}\n`;
  });
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob); a.download='calendar.csv'; a.click();
}

function importCSV(event){
  const file=event.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=function(e){
    const lines=e.target.result.split('\n').slice(1);
    events=[];
    lines.forEach(l=>{
      if(!l.trim()) return;
      const [date,name,category,time,allDay,recM,recA]=l.split(',');
      events.push({date,name,category,time,allDay:allDay==='true',recMonthly:recM==='true',recAnnual:recA==='true'});
    });
    renderCalendar();
  }
  reader.readAsText(file);
  event.target.value='';
}

renderCalendar();
</script>
</body>
</html>
