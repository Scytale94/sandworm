<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calendar</title>
  <style>
    :root {
      --bg: #2a1b2e;
      --section-bg: #3b2640;
      --card-bg: #4b2b50;
      --text: #f3e5f5;
      --muted: #dcdcdc;
      --accent: #8e24aa;
      --hover: #7b1fa2;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
    }

    h1 {
      text-align: center;
      padding: 20px;
      color: var(--accent);
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      padding: 20px;
      background: var(--section-bg);
      margin: auto;
      max-width: 900px;
      border-radius: 12px;
    }

    .day {
      background: var(--card-bg);
      border-radius: 8px;
      min-height: 120px;
      padding: 6px;
      position: relative;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: background 0.2s;
    }

    .day:hover {
      background: var(--hover);
    }

    .day-number {
      font-size: 14px;
      font-weight: bold;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .event {
      background: var(--accent);
      color: white;
      border-radius: 6px;
      padding: 2px 5px;
      font-size: 12px;
      margin-bottom: 2px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .event span {
      flex-grow: 1;
    }

    .event button {
      background: transparent;
      border: none;
      color: white;
      cursor: pointer;
      margin-left: 5px;
      font-size: 10px;
    }

    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 10px auto;
      flex-wrap: wrap;
    }

    button {
      background-color: var(--accent);
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background-color: var(--hover);
    }

    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      min-width: 280px;
    }

    .modal-content input,
    .modal-content select {
      width: 100%;
      padding: 6px;
      margin: 5px 0;
      border: none;
      border-radius: 6px;
    }

    .csv-controls {
      text-align: center;
      margin: 20px;
    }
  </style>
</head>
<body>
  <h1>My Calendar</h1>
  <div class="controls">
    <button id="prevMonth">â—€ Prev</button>
    <h2 id="monthYear"></h2>
    <button id="nextMonth">Next â–¶</button>
  </div>
  <div class="calendar" id="calendar"></div>

  <div class="csv-controls">
    <button id="exportCSVBtn">Export to CSV</button>
    <input type="file" id="importCSV" accept=".csv" style="display:none;">
    <button onclick="document.getElementById('importCSV').click()">Import from CSV</button>
  </div>

  <div class="modal" id="eventModal">
    <div class="modal-content">
      <h3 id="modalTitle">Add Event</h3>
      <input type="text" id="eventTitle" placeholder="Event title">
      <label>
        <input type="checkbox" id="allDay"> All Day
      </label>
      <input type="time" id="eventTime">
      <select id="eventCategory">
        <option value="personal">Personal</option>
        <option value="family">Family</option>
        <option value="work">Work</option>
      </select>
      <div style="text-align:right;margin-top:10px;">
        <button id="saveEvent">Save</button>
        <button onclick="closeModal()">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    const calendarEl = document.getElementById("calendar");
    const monthYearEl = document.getElementById("monthYear");
    const eventModal = document.getElementById("eventModal");
    const eventTitle = document.getElementById("eventTitle");
    const eventTime = document.getElementById("eventTime");
    const eventCategory = document.getElementById("eventCategory");
    const allDayCheckbox = document.getElementById("allDay");
    let currentDate = new Date();
    let selectedDate = null;
    let events = JSON.parse(localStorage.getItem("calendarEvents")) || [];

    function saveEvents() {
      localStorage.setItem("calendarEvents", JSON.stringify(events));
    }

    function renderCalendar() {
      calendarEl.innerHTML = "";
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      monthYearEl.textContent = currentDate.toLocaleDateString("en-US", {
        month: "long", year: "numeric"
      });

      for (let i = 0; i < firstDay; i++) {
        const empty = document.createElement("div");
        calendarEl.appendChild(empty);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${year}-${String(month + 1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
        const dayEl = document.createElement("div");
        dayEl.className = "day";
        const numEl = document.createElement("div");
        numEl.className = "day-number";
        numEl.textContent = day;
        dayEl.appendChild(numEl);

        const dayEvents = events.filter(e => e.date === dateStr);
        const allDayEvents = dayEvents.filter(e => e.allDay);
        const timedEvents = dayEvents.filter(e => !e.allDay);

        // Sort timed events by time
        timedEvents.sort((a,b) => (a.startTime || "").localeCompare(b.startTime));

        [...allDayEvents, ...timedEvents].forEach(e => {
          const eventEl = document.createElement("div");
          eventEl.className = "event";
          const timeLabel = e.allDay ? "All Day" : formatTime(e.startTime);
          eventEl.innerHTML = `<span>[${e.category}] ${e.title} (${timeLabel})</span>`;
          const editBtn = document.createElement("button");
          editBtn.textContent = "âœŽ";
          editBtn.onclick = (ev) => { ev.stopPropagation(); editEvent(e); };
          const delBtn = document.createElement("button");
          delBtn.textContent = "ðŸ—‘";
          delBtn.onclick = (ev) => { ev.stopPropagation(); deleteEvent(e); };
          eventEl.append(editBtn, delBtn);
          dayEl.appendChild(eventEl);
        });

        dayEl.addEventListener("click", () => openModal(dateStr));
        calendarEl.appendChild(dayEl);
      }
    }

    function formatTime(timeStr) {
      if (!timeStr) return "";
      const [hour, minute] = timeStr.split(":").map(Number);
      const ampm = hour >= 12 ? "PM" : "AM";
      const hour12 = hour % 12 || 12;
      return `${hour12}:${minute.toString().padStart(2,"0")} ${ampm}`;
    }

    function openModal(dateStr) {
      selectedDate = dateStr;
      eventTitle.value = "";
      eventTime.value = "";
      eventCategory.value = "personal";
      allDayCheckbox.checked = false;
      eventModal.style.display = "flex";
      setTimeout(() => eventTitle.focus(), 50);
    }

    function closeModal() {
      eventModal.style.display = "none";
    }

    document.getElementById("saveEvent").addEventListener("click", () => {
      const title = eventTitle.value.trim();
      if (!title) return alert("Enter an event title.");
      const newEvent = {
        title,
        date: selectedDate,
        startTime: allDayCheckbox.checked ? "" : eventTime.value,
        category: eventCategory.value,
        allDay: allDayCheckbox.checked
      };
      events.push(newEvent);
      saveEvents();
      closeModal();
      renderCalendar();
    });

    function editEvent(e) {
      openModal(e.date);
      eventTitle.value = e.title;
      eventTime.value = e.startTime || "";
      eventCategory.value = e.category;
      allDayCheckbox.checked = e.allDay;
      document.getElementById("saveEvent").onclick = () => {
        e.title = eventTitle.value.trim();
        e.startTime = allDayCheckbox.checked ? "" : eventTime.value;
        e.category = eventCategory.value;
        e.allDay = allDayCheckbox.checked;
        saveEvents();
        closeModal();
        renderCalendar();
        document.getElementById("saveEvent").onclick = saveEventDefault;
      };
    }

    const saveEventDefault = document.getElementById("saveEvent").onclick;

    function deleteEvent(e) {
      if (confirm("Delete this event?")) {
        events = events.filter(ev => ev !== e);
        saveEvents();
        renderCalendar();
      }
    }

    document.getElementById("prevMonth").addEventListener("click", () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    });

    document.getElementById("nextMonth").addEventListener("click", () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    });

    // CSV EXPORT
    function exportToCSV() {
      if (events.length === 0) {
        alert("No events to export!");
        return;
      }
      const headers = ["Title","Date","StartTime","Category","AllDay"];
      const rows = events.map(e => [
        e.title, e.date, e.startTime || "", e.category, e.allDay ? "Yes" : "No"
      ]);
      const csv = [headers.join(","), ...rows.map(r=>r.join(","))].join("\n");
      const blob = new Blob([csv], {type:"text/csv"});
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "calendar_events.csv";
      link.click();
    }

    function importFromCSV(ev) {
      const file = ev.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        const text = e.target.result;
        const lines = text.trim().split("\n");
        lines.shift(); // remove header
        const imported = lines.map(l=>{
          const [title,date,startTime,category,allDay] = l.split(",");
          return {title,date,startTime,category,allDay: allDay.trim().toLowerCase()==="yes"};
        });
        events.push(...imported);
        saveEvents();
        renderCalendar();
        alert("Events imported successfully!");
      };
      reader.readAsText(file);
    }

    document.getElementById("exportCSVBtn").addEventListener("click", exportToCSV);
    document.getElementById("importCSV").addEventListener("change", importFromCSV);

    renderCalendar();
  </script>
</body>
</html>
